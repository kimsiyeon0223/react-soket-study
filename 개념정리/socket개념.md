# 소켓 통신

## 1. 네트워크 기본 구조

### 1-1. OSI 7 계층

#### IOS : 국제표준화기구
ISO는 네트워크 통신 규약(프로토콜)과 기본적인 네트워크 통신 구조 모델을 정하는 데 그게 OSI 7 계층입니다. <br />
<img src="https://i.ibb.co/3YzyTCc/2.jpg" alt="2" />
1. <b>응용 계층</b> : 사용자가 직접적으로 사용하는 인터넷과 이메일이 이 영역에 해당합니다. 주로 사용자와 인터페이스 역할을 합니다. <br />
2. <b>표현 계층</b> : 데이터를 표현하는 역할을 합니다. 표현하는 방법으로는 데이터 암호화, 복호화, 압축 등이 있습니다.
3. <b>세션 계층</b> : 두 장치 사이의 동기화를 담당합니다. 오류가 발생한다면 복구하는 과정이 이루어집니다.
4. <b>전송 계층</b> : 장치 사이의 신뢰성 있는 데이터 전송을 담당합니다. 그래서 오류 검출과 데이터 흐름 데어 등의 기능을 제공합니다. 또한 우리가 흔히 알고 있는 포트(port)를 사용해서 데이터를 전송합니다.<br />
5. <b>네트워크 계층</b> : 라우팅의 역할을 맡고 있습니다. 가장 안전하고 빠른 길을 안내합니다.
6. <b>데이터 링크 게층</b> : 물리적 연결을 담당하며 MAC 주소를 이용해서 통신합니다.
7. <b>물리 계층</b> : 전기적, 기게적인 특성ㅇ르 이용해서 데이터를 전송합니다. 데이터는 0과 1 뿐이며 데이터 전달하는 기능만 있기 때문에 오류 제어와 알고리즘 같은 역할은 할 수 없습니다.
> 일곱 단계마다 각각의 역할과 프로토콜의 영역이 다릅니다. 여기서 모든 단계를 설명하는 건 의미가 없습니다. <br />
중요한 점은 송신을 하는 입장에서는 각각의 단계를 거치면서 헤더 정보를 추가해서 수신자에게 보낸다는 사실입니다. 그러면 이 데이터 덩어리를 받은 수신자는 반대로 헤더의 정보를 해석하면서 정보를 받게 됩니다.

<br />
<br />

### 1-2. TCP/IP 4 계층
OSI 7 계층에는 한 가지 문제가 있었습니다.
데이터를 어떻게 하면 원하는 위치에 안정적으로 전송할 수 있는 방법에 대해 고민하게 되었습니다. 이 과정에서 OSI 7 계층이라는 거대한 구조보다 조금 더 실무적이고 단순화한 모델을 찾다가 TCP/IP 4 계층이 나왔습니다.

#### TCP/IP : 컴퓨터 사이의 정보를 주고받을 수 있는 통신 규약(protocol)의 집합을 말합니다.
<img src="https://i.ibb.co/YW3ZKPh/4.jpg" alt="4" />
1. <b>TCP(Transmission Control Protocol)</b> : 전송제어 프로토콜로 포트 번호를 사용하며 기기 간의 '안전한' 데이터 전송을 담당합니다. '안전한'을 강조한 이유는 신뢰를 보장하지 않는 UDP(User Datagram Protocol)도 있기 때문입니다. <br />
2. IP(Internet Protocol)는 기기 간의 가장 빠른 데이터 전송을 담당합니다. (우리가 흔히 말하는 IP 주소가 여기서 나왔습니다.) <br />
<br />

<b>* 결론적으로 HTTP는 사실 TCP 기반으로 만들어졌기 떄문에 소켓 방식으로 만들어졌다고 볼 수 있습니다.</b>

<br />
<br />
<br />

### 1.2 소켓 통신
#### 소켓의 정의
소켓 통신이란 TCP 혹은 UDP 프로토콜을 사용하는 두 기기 간의 연결입니다. (이러한 연결을 하기 위해 특정한 IP 주소와 포트 번호를 이용해서 통신 연결을 유지합니다.) <br />
클라이언트와 서버가 실시간으로 데이터를 주고받기 위해선 특정한 연결이 계속 이어져 있어야 합니다.(흔히 '커넥션'이라고 함)
HTTP 통신과는 다르게 연결을 유지하기 위해선 컴퓨터의 자원을 소모하여 커넥션이 많을수록 <b>부하가 발생</b>합니다. <Br />
> <b>그래서 데이터 통신이 자주 일어난다면 소켓 통신을(양방향 통신) 사용하지만 데이터 통신이 자주 발생하지 않는다면 HTTP 통신(단방향 통신)이 적합합니다. </b>

<br />
<br />

#### HTTP를 이용한 양방향 통신 기법도 있다!!<br />
- 폴링(Polling) : 클라이언트가 특정 시간을 간격으로 계속 서버에 request를 요청하는 방식입니다. 계속 요청해서 응답이 있는지 확인하기 때문에 <b>불필요한 요청과 부하가 발생</b>합니다.<br />
- 롱 폴링(Long Polling) : 폴리의 무분별한 확인 요청과 서버 부하를 줄이기 위한 방법입니다. 폴링처럼 지속적으로 확인하는 것이 아닌 서버에서 이벤트가 발생하면 그때 클라이언트에게 응답을 주는 방식입니다.
- 스트리밍(streaming) : 롱 폴링처럼 연결을 맺고 끊는 것이 아니라 지속적인 연결 상태로 서버의 데이터를 클라이언트가 받을 수 있습니다. <br />
<br />

위 방식들 모두 구현이 단순하다는 장점이 주를 이루지만 HTTP 통신을 기반으로 하기 때문에 <b>큰 헤더 정보는 서버에 부담</b>이 될 수 있습니다. 또한 폴링 같은 경우 실시간 통신으로 보기 어렵습니다..

<br />
<br />
<br />

### 소켓 통신 프로세스

#### 3방향 핸드셰이크
> 3방향 핸드셰이크 : 신뢰성 있는 연결을 위해 서버와 클라이언트 간의 사전 약속이라고 말할 수 있습니다. <br />

안전한 TCP 통신을 위해선 클라이언트의 요청이 안전하게 서버에 도달하기 위한 사전 작업이 필요한데 다음과 같습니다. (TCP 통신은 신뢰를 기반으로 동작한다.)
<img src="https://i.ibb.co/DQJ7PHn/5.jpg" alt="5" border="0" />
1. 소켓 통신을 위해 사전에 클라이언크는 SYN이라는 패킷을 서버에 전송하고 SYN/ACK를 받기 위한 상태로 대기합니다. <br />
2. SYN 패킷을 받은 서버는 클라이언트에서 받은 SYN과 패킷과 잘 받았다는 패킷인 ACK를 하나로 만들어서 다시 클라이언트에 SYN/ACK를 전송합니다. <br />
3. ACK를 받은 클라이언트는 다시 서버로 ACK 패킷을 보내며 잘 받았다는 요청을 보내게 됩니다. <br />
<br />

이 과정이 3단계로 이루어져 3방향 핸드셰이크라고 합니다.
<br />
<br />
UDP 통신은 3방향 핸드셰이크가 없다!!
UDP는 비신뢰성 연결을 지향한다.
<img src="https://i.ibb.co/QcnqKJc/6.jpg" alt="6" border="0" />

<br />
<br />

#### HTML5 웹 소켓의 한계
HTML5와 함께 등장한 웹 소켓은 IE8과 같은 하위 브라우저에서는 사용하지 못하는 단점이 있습니다. 또한 TCP를 기반으로 하는 브라우저는 HTTP 통신을 사용하기 때문에 비연결을 지향하는 UDP 기반으로는 사용할 수 없습니다.